============================================================
Agenda
============================================================

Help assess how suitable this restaurant is for romantic occasions.

Analyze each review to identify mentions of romantic dining experiences.
For each record, extract the L0 primitives defined below.

This task combines complex formula (weighted factors, interactions)
with L1.5 occasion type grouping for pattern detection.

============================================================
L0: Primitives (per-review extraction)
============================================================

OCCASION_TYPE
- date_night: casual romantic dinner
- anniversary: special celebration of relationship milestone
- proposal: engagement or special romantic gesture
- first_date: getting to know someone
- valentines: Valentine's Day or similar romantic holiday
- general_romantic: romantic context without specific occasion
- not_romantic: not a romantic context

AMBIANCE_RATING
- excellent: specifically praised as romantic, intimate, beautiful
- good: pleasant atmosphere conducive to romance
- neutral: adequate but not particularly romantic
- poor: atmosphere detracts from romantic experience (loud, harsh lighting, etc.)
- not_mentioned: ambiance not discussed

PRIVACY_LEVEL
- intimate: private booths, secluded seating, quiet corners
- adequate: reasonable spacing between tables
- lacking: crowded, tables too close, feels exposed
- not_mentioned: privacy not discussed

NOISE_LEVEL
- quiet: easy to have intimate conversation
- moderate: acceptable background noise
- loud: difficult to converse, disruptive
- not_mentioned: noise not discussed

SERVICE_ATTENTIVENESS
- attentive: staff was appropriately present without being intrusive
- inattentive: staff was absent when needed
- intrusive: staff interrupted too frequently
- not_mentioned: service style not discussed

ROMANTIC_ELEMENTS
- present: candles, flowers, special touches, romantic music
- absent: no romantic touches noted
- negative: unromantic elements (TVs blaring, bright lights)
- not_mentioned: not discussed

OUTCOME_SENTIMENT
- delighted: explicitly praised as perfect for romance
- satisfied: had a good romantic experience
- disappointed: romantic experience fell short
- ruined: romantic occasion was negatively impacted
- not_mentioned: outcome not discussed

============================================================
L1: Composites (derived per review) - COMPLEX
============================================================

Occasion Weight (higher stakes = more weight):
  proposal = 2.0
  anniversary = 1.8
  valentines = 1.5
  date_night = 1.0
  first_date = 1.2
  general_romantic = 1.0
  not_romantic = 0

Ambiance Score:
  excellent = +3
  good = +1.5
  neutral = 0
  poor = -2
  not_mentioned = 0

Privacy Score:
  intimate = +2
  adequate = +0.5
  lacking = -1.5
  not_mentioned = 0

Noise Score:
  quiet = +2
  moderate = 0
  loud = -3
  not_mentioned = 0

Service Score:
  attentive = +1.5
  inattentive = -1
  intrusive = -1.5
  not_mentioned = 0

Romantic Elements Score:
  present = +1.5
  absent = 0
  negative = -2
  not_mentioned = 0

Outcome Modifier:
  delighted = +2
  satisfied = +1
  disappointed = -2
  ruined = -4
  not_mentioned = 0

L1_REVIEW_SCORE = (AMBIANCE_SCORE + PRIVACY_SCORE + NOISE_SCORE + SERVICE_SCORE + ROMANTIC_ELEMENTS_SCORE + OUTCOME_MODIFIER) * OCCASION_WEIGHT

RUINED_SPECIAL_OCCASION (interaction effect):
  If OCCASION_TYPE in {proposal, anniversary} AND OUTCOME_SENTIMENT = ruined: -5.0
  Else: 0

L1_TOTAL_SCORE = L1_REVIEW_SCORE + RUINED_SPECIAL_OCCASION

============================================================
L1.5: Occasion Type Grouping
============================================================

Group reviews by OCCASION_TYPE:
  SPECIAL_OCCASION = anniversary, proposal, valentines (high-stakes romantic)
  DATE_NIGHT = date_night, general_romantic (regular romantic dining)
  FIRST_DATE = first_date (needs comfortable, not-too-intense atmosphere)

For each occasion bucket, compute:
  BUCKET_N_REVIEWS = count of reviews in this bucket
  BUCKET_SUM_SCORE = sum of L1_TOTAL_SCORE in bucket
  BUCKET_SUM_WEIGHT = sum of OCCASION_WEIGHT in bucket
  BUCKET_WEIGHTED_SCORE = BUCKET_SUM_SCORE / max(BUCKET_SUM_WEIGHT, 1)
  BUCKET_N_DELIGHTED = count where OUTCOME_SENTIMENT = delighted in bucket
  BUCKET_N_RUINED = count where OUTCOME_SENTIMENT = ruined in bucket

Occasion Pattern Analysis:
  BEST_OCCASION = occasion bucket with highest WEIGHTED_SCORE (if any data)
  BEST_OCCASION_SCORE = WEIGHTED_SCORE of BEST_OCCASION
  WORST_OCCASION = occasion bucket with lowest WEIGHTED_SCORE (if any data)
  WORST_OCCASION_SCORE = WEIGHTED_SCORE of WORST_OCCASION
  N_OCCASIONS_EXCELLENT = count of buckets where WEIGHTED_SCORE >= 3.0

  ROMANCE_VERSATILITY:
    if N_OCCASIONS_EXCELLENT >= 3: "universally_romantic"
    elif SPECIAL_OCCASION bucket WEIGHTED_SCORE >= 4.0: "special_occasion_expert"
    elif DATE_NIGHT bucket WEIGHTED_SCORE >= 3.0: "reliable_date_spot"
    elif FIRST_DATE bucket WEIGHTED_SCORE >= 3.0: "great_first_impression"
    elif BEST_OCCASION_SCORE - WORST_OCCASION_SCORE > 4.0: "inconsistent"
    elif BEST_OCCASION_SCORE >= 2.0: "situational"
    else: "not_recommended"

============================================================
L2: Aggregates (restaurant-level)
============================================================

Constants:
  BASE_SCORE = 5.0

Counts:
  N_ROMANTIC_REVIEWS = count of reviews where OCCASION_TYPE != not_romantic
  N_DELIGHTED = count where OUTCOME_SENTIMENT = delighted
  N_RUINED = count where OUTCOME_SENTIMENT = ruined
  N_SPECIAL_OCCASIONS = count where OCCASION_TYPE in {proposal, anniversary, valentines}

Confidence Level:
  if N_ROMANTIC_REVIEWS == 0: none
  elif N_ROMANTIC_REVIEWS <= 2: low
  elif N_ROMANTIC_REVIEWS <= 5: medium
  else: high

L1.5 Occasion Aggregation:
  TOTAL_OCCASION_SCORE = sum of BUCKET_WEIGHTED_SCORE across all occasion buckets
  N_OCCASION_BUCKETS_ACTIVE = count of buckets where N_REVIEWS > 0
  MEAN_OCCASION_SCORE = TOTAL_OCCASION_SCORE / max(N_OCCASION_BUCKETS_ACTIVE, 1)

============================================================
Formulas & Decision Policy
============================================================

Formulas:
  Versatility Multiplier (based on romance versatility):
    if ROMANCE_VERSATILITY = "universally_romantic": VERS_MULT = 1.2
    elif ROMANCE_VERSATILITY = "special_occasion_expert": VERS_MULT = 1.15
    elif ROMANCE_VERSATILITY = "reliable_date_spot": VERS_MULT = 1.1
    elif ROMANCE_VERSATILITY = "inconsistent": VERS_MULT = 0.9
    elif ROMANCE_VERSATILITY = "not_recommended": VERS_MULT = 0.7
    else: VERS_MULT = 1.0

  ADJUSTED_SCORE = MEAN_OCCASION_SCORE * VERS_MULT
  RAW_SCORE = BASE_SCORE + ADJUSTED_SCORE
  FINAL_SCORE = clamp(RAW_SCORE, 0.0, 10.0)

Decision Thresholds on FINAL_SCORE:
  - >= 7.5 => Highly Romantic (perfect for special occasions)
  - >= 5.5 AND < 7.5 => Romantic (good for dates)
  - >= 3.5 AND < 5.5 => Somewhat Romantic (acceptable for casual dates)
  - < 3.5 => Not Romantic (not recommended for romantic occasions)

Overrides:
  - If N_RUINED >= 1 AND was SPECIAL_OCCASION => max Somewhat Romantic
  - If ROMANCE_VERSATILITY = "universally_romantic" => min Romantic
  - If ROMANCE_VERSATILITY = "special_occasion_expert" AND N_DELIGHTED >= 2 => min Romantic
  - If SPECIAL_OCCASION bucket N_RUINED >= 1 => include warning in verdict
  - If ROMANCE_VERSATILITY = "inconsistent" => include occasion guidance

============================================================
Output Schema
============================================================

{
  L0_primitives: [ ... one record per romantic-related review ... ],
  L1_composites: [
    {
      review_id,
      occasion_type,
      occasion_weight,
      ambiance_score,
      privacy_score,
      noise_score,
      service_score,
      romantic_elements_score,
      outcome_modifier,
      l1_review_score,
      ruined_special_occasion,
      l1_total_score
    },
    ...
  ],
  L1_5_occasion_buckets: {
    special_occasion: { n_reviews, sum_score, sum_weight, weighted_score, n_delighted, n_ruined },
    date_night: { n_reviews, sum_score, sum_weight, weighted_score, n_delighted, n_ruined },
    first_date: { n_reviews, sum_score, sum_weight, weighted_score, n_delighted, n_ruined },
    best_occasion,
    best_occasion_score,
    worst_occasion,
    worst_occasion_score,
    n_occasions_excellent,
    romance_versatility
  },
  L2_aggregates: {
    N_ROMANTIC_REVIEWS,
    CONFIDENCE_LEVEL,
    N_DELIGHTED, N_RUINED,
    N_SPECIAL_OCCASIONS,
    TOTAL_OCCASION_SCORE,
    MEAN_OCCASION_SCORE,
    VERS_MULT,
    BASE_SCORE,
    ADJUSTED_SCORE,
    RAW_SCORE,
    FINAL_SCORE
  },
  DecisionPolicy: {
    base_verdict_by_score,
    override_applied,
    VERDICT,
    occasion_guidance (if applicable),
    special_occasion_warning (if applicable)
  },
  decision_evidence: {
    high_score_reviews: [ {review_id, occasion_type, l1_total_score, quote}, ... ],
    low_score_reviews: [ {review_id, occasion_type, l1_total_score, quote}, ... ],
    occasion_evidence: {
      best_occasion,
      best_occasion_score,
      worst_occasion,
      romance_versatility
    }
  }
}
