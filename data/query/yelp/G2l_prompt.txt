============================================================
Agenda
============================================================

Help assess how suitable this restaurant is for group dining.

Analyze each review to identify mentions of group dining experiences.
For each record, extract the L0 primitives defined below.

This task combines complex formula (weighted factors, interactions)
with L1.5 group type grouping for pattern detection.

============================================================
L0: Primitives (per-review extraction)
============================================================

GROUP_TYPE
- family: family gathering, kids present
- friends: friend group outing
- celebration: birthday, graduation, special event
- work_team: office party, team outing
- large_party: generic large group (6+ people)
- not_group: individual or couple dining

GROUP_SIZE
- small: 3-5 people
- medium: 6-10 people
- large: 11-20 people
- very_large: 20+ people
- not_mentioned: size not specified

SEATING_ACCOMMODATION
- excellent: easily seated large group, private room available
- adequate: seated with some wait or rearrangement
- difficult: long wait, split tables, cramped
- refused: could not accommodate group size
- not_mentioned: seating not discussed

SERVICE_HANDLING
- smooth: staff handled large party well
- adequate: service was acceptable for group size
- struggled: service noticeably worse with group
- overwhelmed: major service issues due to group size
- not_mentioned: service for group not discussed

NOISE_TOLERANCE
- welcomed: restaurant comfortable with lively groups
- tolerated: group noise accepted
- frowned_upon: received looks or comments about noise
- not_mentioned: not discussed

CHECK_SPLITTING
- easy: split checks without issue
- available: able to split but with some effort
- refused: would not split checks
- not_mentioned: not discussed

KIDS_FRIENDLY (if GROUP_TYPE = family)
- very_friendly: kids menu, highchairs, changing stations
- accommodating: basic kid accommodations
- not_suitable: not appropriate for children
- not_mentioned: not discussed

CELEBRATION_SUPPORT (if GROUP_TYPE = celebration)
- excellent: cake, decorations, special treatment
- basic: acknowledged the occasion
- none: no special treatment
- not_mentioned: not discussed

============================================================
L1: Composites (derived per review) - COMPLEX
============================================================

Group Size Weight (larger = harder to accommodate):
  small = 1.0
  medium = 1.5
  large = 2.0
  very_large = 2.5
  not_mentioned = 1.0

Seating Score:
  excellent = +3
  adequate = +1
  difficult = -2
  refused = -5
  not_mentioned = 0

Service Score:
  smooth = +3
  adequate = +1
  struggled = -2
  overwhelmed = -4
  not_mentioned = 0

Noise Score:
  welcomed = +1.5
  tolerated = +0.5
  frowned_upon = -2
  not_mentioned = 0

Check Score:
  easy = +1.5
  available = +0.5
  refused = -1.5
  not_mentioned = 0

L1_REVIEW_SCORE = (SEATING_SCORE + SERVICE_SCORE + NOISE_SCORE + CHECK_SCORE) * GROUP_SIZE_WEIGHT

FAMILY_BONUS (interaction):
  If GROUP_TYPE = family AND KIDS_FRIENDLY = very_friendly: +2.0
  If GROUP_TYPE = family AND KIDS_FRIENDLY = not_suitable: -3.0
  Else: 0

CELEBRATION_BONUS (interaction):
  If GROUP_TYPE = celebration AND CELEBRATION_SUPPORT = excellent: +2.0
  Else: 0

REFUSED_LARGE_GROUP (interaction):
  If GROUP_SIZE in {large, very_large} AND SEATING_ACCOMMODATION = refused: -5.0
  Else: 0

L1_TOTAL_SCORE = L1_REVIEW_SCORE + FAMILY_BONUS + CELEBRATION_BONUS + REFUSED_LARGE_GROUP

============================================================
L1.5: Group Type Grouping
============================================================

Group reviews by GROUP_TYPE:
  FAMILY = family gatherings (may need kid-friendly features)
  SOCIAL = friends, celebration (fun atmosphere matters)
  PROFESSIONAL = work_team, large_party (need reliable service)

For each group bucket, compute:
  BUCKET_N_REVIEWS = count of reviews in this bucket
  BUCKET_SUM_SCORE = sum of L1_TOTAL_SCORE in bucket
  BUCKET_SUM_WEIGHT = sum of GROUP_SIZE_WEIGHT in bucket
  BUCKET_WEIGHTED_SCORE = BUCKET_SUM_SCORE / max(BUCKET_SUM_WEIGHT, 1)
  BUCKET_N_LARGE = count where GROUP_SIZE in {large, very_large} in bucket
  BUCKET_N_REFUSED = count where SEATING_ACCOMMODATION = refused in bucket

Group Pattern Analysis:
  BEST_GROUP_TYPE = bucket with highest WEIGHTED_SCORE (if any data)
  BEST_GROUP_SCORE = WEIGHTED_SCORE of BEST_GROUP_TYPE
  WORST_GROUP_TYPE = bucket with lowest WEIGHTED_SCORE (if any data)
  WORST_GROUP_SCORE = WEIGHTED_SCORE of WORST_GROUP_TYPE
  N_GROUP_TYPES_EXCELLENT = count of buckets where WEIGHTED_SCORE >= 3.0

  GROUP_VERSATILITY:
    if N_GROUP_TYPES_EXCELLENT >= 3: "all_groups_champion"
    elif FAMILY bucket WEIGHTED_SCORE >= 4.0: "family_destination"
    elif SOCIAL bucket WEIGHTED_SCORE >= 4.0: "celebration_central"
    elif PROFESSIONAL bucket WEIGHTED_SCORE >= 4.0: "corporate_event_ready"
    elif BEST_GROUP_SCORE - WORST_GROUP_SCORE > 4.0: "inconsistent"
    elif BEST_GROUP_SCORE >= 2.0: "situational"
    else: "not_recommended"

============================================================
L2: Aggregates (restaurant-level)
============================================================

Constants:
  BASE_SCORE = 5.0

Counts:
  N_GROUP_REVIEWS = count of reviews where GROUP_TYPE != not_group
  N_LARGE_GROUPS = count where GROUP_SIZE in {large, very_large}
  N_REFUSED = count where SEATING_ACCOMMODATION = refused
  N_FAMILY = count where GROUP_TYPE = family
  N_CELEBRATIONS = count where GROUP_TYPE = celebration

Confidence Level:
  if N_GROUP_REVIEWS == 0: none
  elif N_GROUP_REVIEWS <= 2: low
  elif N_GROUP_REVIEWS <= 5: medium
  else: high

L1.5 Group Aggregation:
  TOTAL_GROUP_SCORE = sum of BUCKET_WEIGHTED_SCORE across all group buckets
  N_GROUP_BUCKETS_ACTIVE = count of buckets where N_REVIEWS > 0
  MEAN_GROUP_SCORE = TOTAL_GROUP_SCORE / max(N_GROUP_BUCKETS_ACTIVE, 1)

============================================================
Formulas & Decision Policy
============================================================

Formulas:
  Versatility Multiplier (based on group versatility):
    if GROUP_VERSATILITY = "all_groups_champion": VERS_MULT = 1.2
    elif GROUP_VERSATILITY in {"family_destination", "celebration_central", "corporate_event_ready"}: VERS_MULT = 1.15
    elif GROUP_VERSATILITY = "inconsistent": VERS_MULT = 0.9
    elif GROUP_VERSATILITY = "not_recommended": VERS_MULT = 0.7
    else: VERS_MULT = 1.0

  ADJUSTED_SCORE = MEAN_GROUP_SCORE * VERS_MULT
  RAW_SCORE = BASE_SCORE + ADJUSTED_SCORE
  FINAL_SCORE = clamp(RAW_SCORE, 0.0, 10.0)

Decision Thresholds on FINAL_SCORE:
  - >= 7.5 => Excellent for Groups
  - >= 5.5 AND < 7.5 => Good for Groups
  - >= 3.5 AND < 5.5 => Limited
  - < 3.5 => Not Suitable

Overrides:
  - If N_REFUSED >= 1 => max Good for Groups (capacity issue)
  - If GROUP_VERSATILITY = "all_groups_champion" => min Good for Groups
  - If GROUP_VERSATILITY = "family_destination" AND FAMILY bucket N_REVIEWS >= 3 => min Limited + family recommendation
  - If GROUP_VERSATILITY = "inconsistent" => include group guidance
  - If any bucket has N_REFUSED >= 1 => note capacity limitation for that group type

============================================================
Output Schema
============================================================

{
  L0_primitives: [ ... one record per group-related review ... ],
  L1_composites: [
    {
      review_id,
      group_type,
      group_size_weight,
      seating_score,
      service_score,
      noise_score,
      check_score,
      l1_review_score,
      family_bonus,
      celebration_bonus,
      refused_large_group,
      l1_total_score
    },
    ...
  ],
  L1_5_group_buckets: {
    family: { n_reviews, sum_score, sum_weight, weighted_score, n_large, n_refused },
    social: { n_reviews, sum_score, sum_weight, weighted_score, n_large, n_refused },
    professional: { n_reviews, sum_score, sum_weight, weighted_score, n_large, n_refused },
    best_group_type,
    best_group_score,
    worst_group_type,
    worst_group_score,
    n_group_types_excellent,
    group_versatility
  },
  L2_aggregates: {
    N_GROUP_REVIEWS,
    CONFIDENCE_LEVEL,
    N_LARGE_GROUPS,
    N_REFUSED,
    N_FAMILY,
    N_CELEBRATIONS,
    TOTAL_GROUP_SCORE,
    MEAN_GROUP_SCORE,
    VERS_MULT,
    BASE_SCORE,
    ADJUSTED_SCORE,
    RAW_SCORE,
    FINAL_SCORE
  },
  DecisionPolicy: {
    base_verdict_by_score,
    override_applied,
    VERDICT,
    group_guidance (if applicable),
    capacity_note (if applicable)
  },
  decision_evidence: {
    high_score_reviews: [ {review_id, group_type, l1_total_score, quote}, ... ],
    low_score_reviews: [ {review_id, group_type, l1_total_score, quote}, ... ],
    group_evidence: {
      best_group_type,
      best_group_score,
      worst_group_type,
      group_versatility
    }
  }
}
