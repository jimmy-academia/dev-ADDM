============================================================
Agenda
============================================================

Help assess the quality of server/staff service at this restaurant.

Analyze each review to identify mentions of server interactions and service quality.
For each record, extract the L0 primitives defined below.

This task combines complex formula (weighted factors, interactions)
with L1.5 service aspect grouping for pattern detection.

============================================================
L0: Primitives (per-review extraction)
============================================================

ATTENTIVENESS
- excellent: proactively attentive, anticipated needs
- good: responsive when needed
- adequate: acceptable but not memorable
- poor: had to flag down server repeatedly
- neglectful: felt ignored or abandoned
- not_mentioned: attentiveness not discussed

MENU_KNOWLEDGE
- expert: deep knowledge, great recommendations
- good: answered questions well
- limited: couldn't answer some questions
- poor: gave wrong information
- not_mentioned: knowledge not discussed

FRIENDLINESS
- warm: genuinely friendly, made guests feel welcome
- professional: polite and courteous
- neutral: neither friendly nor unfriendly
- cold: unfriendly or unwelcoming
- rude: actively rude or hostile
- not_mentioned: friendliness not discussed

ERROR_HANDLING
- excellent: fixed mistakes gracefully, compensated
- good: acknowledged and corrected errors
- poor: defensive or dismissive about errors
- denied: refused to acknowledge mistakes
- no_errors: no errors to handle
- not_mentioned: not discussed

PROFESSIONALISM
- exemplary: went above and beyond
- professional: met expectations
- unprofessional: inappropriate behavior noted
- not_mentioned: not discussed

PERSONALIZATION
- personalized: remembered preferences, made personal connection
- standard: normal service interaction
- impersonal: felt like just another customer
- not_mentioned: not discussed

============================================================
L1: Composites (derived per review) - COMPLEX
============================================================

Attentiveness Score:
  excellent = +3.0
  good = +1.5
  adequate = 0
  poor = -2.0
  neglectful = -4.0
  not_mentioned = 0

Knowledge Score:
  expert = +2.0
  good = +1.0
  limited = -0.5
  poor = -2.0
  not_mentioned = 0

Friendliness Score:
  warm = +2.5
  professional = +1.5
  neutral = 0
  cold = -2.0
  rude = -4.0
  not_mentioned = 0

Error Handling Score:
  excellent = +2.5
  good = +1.0
  poor = -2.0
  denied = -3.5
  no_errors = +0.5
  not_mentioned = 0

Professionalism Score:
  exemplary = +2.0
  professional = +1.0
  unprofessional = -3.0
  not_mentioned = 0

L1_SERVICE_SCORE = ATTENTIVENESS_SCORE + KNOWLEDGE_SCORE + FRIENDLINESS_SCORE + ERROR_HANDLING_SCORE + PROFESSIONALISM_SCORE

RUDE_AND_NEGLECTFUL (interaction penalty):
  If FRIENDLINESS = rude AND ATTENTIVENESS in {poor, neglectful}: -3.0
  Else: 0

L1_TOTAL_SCORE = L1_SERVICE_SCORE + RUDE_AND_NEGLECTFUL

============================================================
L1.5: Service Aspect Grouping
============================================================

Group reviews by service aspect:
  ATTENTIVENESS_ASPECT = reviews with attentiveness data
  KNOWLEDGE_ASPECT = reviews with menu knowledge data
  ATTITUDE_ASPECT = reviews with friendliness or professionalism data

For each aspect bucket, compute:
  BUCKET_N_REVIEWS = count of reviews in this bucket
  BUCKET_SUM_SCORE = sum of relevant scores in bucket
    (ATTENTIVENESS_ASPECT: attentiveness_score)
    (KNOWLEDGE_ASPECT: knowledge_score)
    (ATTITUDE_ASPECT: friendliness_score + professionalism_score)
  BUCKET_MEAN_SCORE = BUCKET_SUM_SCORE / max(BUCKET_N_REVIEWS, 1)
  BUCKET_N_EXCELLENT = count with top-tier rating in this aspect
  BUCKET_N_POOR = count with bottom-tier rating in this aspect

Service Pattern Analysis:
  BEST_ASPECT = bucket with highest MEAN_SCORE
  BEST_ASPECT_SCORE = MEAN_SCORE of BEST_ASPECT
  WORST_ASPECT = bucket with lowest MEAN_SCORE
  WORST_ASPECT_SCORE = MEAN_SCORE of WORST_ASPECT
  N_ASPECTS_EXCELLENT = count of buckets where MEAN_SCORE >= 1.5

  SERVICE_PATTERN:
    if N_ASPECTS_EXCELLENT >= 3: "comprehensively_excellent"
    elif ATTITUDE_ASPECT MEAN_SCORE >= 2.0: "warmth_focused"
    elif ATTENTIVENESS_ASPECT MEAN_SCORE >= 2.0: "efficiency_focused"
    elif KNOWLEDGE_ASPECT MEAN_SCORE >= 1.5: "expertise_focused"
    elif BEST_ASPECT_SCORE - WORST_ASPECT_SCORE > 2.0: "inconsistent_aspects"
    elif N_ASPECTS_EXCELLENT >= 1: "partial_strengths"
    else: "overall_weakness"

============================================================
L2: Aggregates (restaurant-level)
============================================================

Constants:
  BASE_SCORE = 5.0

Counts:
  N_SERVICE_REVIEWS = count of reviews with any service-related primitives
  N_RUDE = count where FRIENDLINESS = rude
  N_NEGLECTFUL = count where ATTENTIVENESS = neglectful
  N_WARM = count where FRIENDLINESS = warm

Confidence Level:
  if N_SERVICE_REVIEWS == 0: none
  elif N_SERVICE_REVIEWS <= 2: low
  elif N_SERVICE_REVIEWS <= 5: medium
  else: high

L1.5 Aspect Aggregation:
  TOTAL_ASPECT_SCORE = sum of BUCKET_MEAN_SCORE across all aspect buckets
  N_ASPECT_BUCKETS_ACTIVE = count of buckets where N_REVIEWS > 0
  MEAN_ASPECT_SCORE = TOTAL_ASPECT_SCORE / max(N_ASPECT_BUCKETS_ACTIVE, 1)

============================================================
Formulas & Decision Policy
============================================================

Formulas:
  Pattern Multiplier (based on service pattern):
    if SERVICE_PATTERN = "comprehensively_excellent": PATTERN_MULT = 1.2
    elif SERVICE_PATTERN in {"warmth_focused", "efficiency_focused", "expertise_focused"}: PATTERN_MULT = 1.1
    elif SERVICE_PATTERN = "inconsistent_aspects": PATTERN_MULT = 0.9
    elif SERVICE_PATTERN = "overall_weakness": PATTERN_MULT = 0.75
    else: PATTERN_MULT = 1.0

  ADJUSTED_SCORE = MEAN_ASPECT_SCORE * PATTERN_MULT
  RAW_SCORE = BASE_SCORE + ADJUSTED_SCORE
  FINAL_SCORE = clamp(RAW_SCORE, 0.0, 10.0)

Decision Thresholds on FINAL_SCORE:
  - >= 7.5 => Excellent Service
  - >= 5.5 AND < 7.5 => Good Service
  - >= 3.5 AND < 5.5 => Mixed Service
  - < 3.5 => Poor Service

Overrides:
  - If N_RUDE >= 2 => Poor Service
  - If SERVICE_PATTERN = "comprehensively_excellent" => min Good Service
  - If SERVICE_PATTERN = "overall_weakness" AND N_NEGLECTFUL >= 1 => Poor Service
  - Include strength note based on BEST_ASPECT
  - Include improvement note based on WORST_ASPECT if score < 0

============================================================
Output Schema
============================================================

{
  L0_primitives: [ ... one record per service-related review ... ],
  L1_composites: [
    {
      review_id,
      attentiveness_score,
      knowledge_score,
      friendliness_score,
      error_handling_score,
      professionalism_score,
      l1_service_score,
      rude_and_neglectful,
      l1_total_score
    },
    ...
  ],
  L1_5_aspect_buckets: {
    attentiveness: { n_reviews, sum_score, mean_score, n_excellent, n_poor },
    knowledge: { n_reviews, sum_score, mean_score, n_excellent, n_poor },
    attitude: { n_reviews, sum_score, mean_score, n_excellent, n_poor },
    best_aspect,
    best_aspect_score,
    worst_aspect,
    worst_aspect_score,
    n_aspects_excellent,
    service_pattern
  },
  L2_aggregates: {
    N_SERVICE_REVIEWS,
    CONFIDENCE_LEVEL,
    N_RUDE, N_NEGLECTFUL, N_WARM,
    TOTAL_ASPECT_SCORE,
    MEAN_ASPECT_SCORE,
    PATTERN_MULT,
    BASE_SCORE,
    ADJUSTED_SCORE,
    RAW_SCORE,
    FINAL_SCORE
  },
  DecisionPolicy: {
    base_verdict_by_score,
    override_applied,
    VERDICT,
    strength_note (if applicable),
    improvement_note (if applicable)
  },
  decision_evidence: {
    high_score_reviews: [ {review_id, aspect, l1_total_score, quote}, ... ],
    low_score_reviews: [ {review_id, aspect, l1_total_score, quote}, ... ],
    aspect_evidence: {
      best_aspect,
      worst_aspect,
      service_pattern
    }
  }
}
