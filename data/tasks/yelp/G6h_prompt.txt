============================================================
Agenda
============================================================

Help assess how this restaurant compares to alternatives and competitors.

Analyze each review to identify mentions of comparisons to other restaurants, competitive positioning, and relative value.
For each record, extract the L0 primitives defined below.

This task combines complex formula (weighted factors, interactions)
with L1.5 comparison-dimension grouping for pattern detection.

============================================================
L0: Primitives (per-review extraction)
============================================================

COMPETITOR_MENTION
- favorable: compares favorably to named competitor
- unfavorable: compares unfavorably to competitor
- similar: similar to competitor
- different: deliberately different from competitor
- not_mentioned: no competitor comparison

CATEGORY_RANKING
- best_in_category: best of this type in area
- top_tier: among the best options
- competitive: holds its own against others
- middle_pack: average among competitors
- bottom_tier: worse than most alternatives
- not_mentioned: ranking not discussed

PRICE_COMPARISON
- best_value: better value than competitors
- fair_value: value comparable to alternatives
- overpriced: more expensive than comparable options
- underpriced: cheaper than expected for quality
- not_mentioned: price comparison not made

QUALITY_COMPARISON
- superior: higher quality than alternatives
- comparable: similar quality to competitors
- inferior: lower quality than competitors
- not_mentioned: quality comparison not made

CONVENIENCE_COMPARISON
- more_convenient: easier/more convenient than alternatives
- equally_convenient: similar convenience to others
- less_convenient: harder to access than alternatives
- not_mentioned: convenience not compared

RECOMMENDATION_CONTEXT
- over_competitor: recommends over specific alternative
- for_specific_need: best for specific purpose
- general_recommendation: general positive recommendation
- conditional: recommendation with caveats
- not_recommended: doesn't recommend over alternatives
- not_mentioned: no recommendation context

============================================================
L1: Composites (derived per review) - COMPLEX
============================================================

Competitor Score:
  favorable = +3.0
  different = +1.0
  similar = 0
  unfavorable = -3.0
  not_mentioned = 0

Ranking Score:
  best_in_category = +4.0
  top_tier = +2.5
  competitive = +1.0
  middle_pack = -0.5
  bottom_tier = -3.0
  not_mentioned = 0

Price Score:
  best_value = +3.0
  underpriced = +2.0
  fair_value = +0.5
  overpriced = -2.5
  not_mentioned = 0

Quality Score:
  superior = +3.5
  comparable = +0.5
  inferior = -3.0
  not_mentioned = 0

Convenience Score:
  more_convenient = +2.0
  equally_convenient = +0.5
  less_convenient = -1.5
  not_mentioned = 0

Recommendation Score:
  over_competitor = +3.0
  for_specific_need = +2.0
  general_recommendation = +1.5
  conditional = 0
  not_recommended = -2.5
  not_mentioned = 0

L1_COMPARISON_SCORE = COMPETITOR_SCORE + RANKING_SCORE + PRICE_SCORE + QUALITY_SCORE + CONVENIENCE_SCORE + RECOMMENDATION_SCORE

============================================================
L1.5: Comparison Dimension Grouping
============================================================

Group reviews by comparison dimension:
  VALUE_DIMENSION = price_comparison data (price_score)
  QUALITY_DIMENSION = quality_comparison, ranking data (quality_score + ranking_score)
  CONVENIENCE_DIMENSION = convenience_comparison data (convenience_score)

For each dimension bucket, compute:
  BUCKET_N_REVIEWS = count of reviews with data in this dimension
  BUCKET_SUM_SCORE = sum of relevant scores in bucket
  BUCKET_MEAN_SCORE = BUCKET_SUM_SCORE / max(BUCKET_N_REVIEWS, 1)
  BUCKET_N_WINS = count with positive score in dimension
  BUCKET_N_LOSSES = count with negative score in dimension

Competitive Pattern Analysis:
  STRONGEST_DIMENSION = bucket with highest MEAN_SCORE
  STRONGEST_SCORE = MEAN_SCORE of STRONGEST_DIMENSION
  WEAKEST_DIMENSION = bucket with lowest MEAN_SCORE
  WEAKEST_SCORE = MEAN_SCORE of WEAKEST_DIMENSION
  N_DIMENSIONS_DOMINANT = count of buckets where MEAN_SCORE >= 2.0

  COMPETITIVE_PATTERN:
    if N_DIMENSIONS_DOMINANT >= 3: "dominant_player"
    elif VALUE_DIMENSION MEAN_SCORE >= 2.5: "value_champion"
    elif QUALITY_DIMENSION MEAN_SCORE >= 3.0: "quality_champion"
    elif CONVENIENCE_DIMENSION MEAN_SCORE >= 2.0: "accessibility_champion"
    elif STRONGEST_SCORE - WEAKEST_SCORE > 3.0: "niche_player"
    elif N_DIMENSIONS_DOMINANT >= 1: "competitive_in_segment"
    else: "losing_ground"

============================================================
L2: Aggregates (restaurant-level)
============================================================

Constants:
  BASE_SCORE = 5.0

Counts:
  N_COMPARISON_REVIEWS = count of reviews with any comparison-related primitives
  N_BEST_IN_CATEGORY = count where CATEGORY_RANKING = best_in_category
  N_BOTTOM_TIER = count where CATEGORY_RANKING = bottom_tier

Confidence Level:
  if N_COMPARISON_REVIEWS == 0: none
  elif N_COMPARISON_REVIEWS <= 2: low
  elif N_COMPARISON_REVIEWS <= 5: medium
  else: high

L1.5 Dimension Aggregation:
  TOTAL_DIMENSION_SCORE = sum of BUCKET_MEAN_SCORE across all dimension buckets
  N_DIMENSION_BUCKETS_ACTIVE = count of buckets where N_REVIEWS > 0
  MEAN_DIMENSION_SCORE = TOTAL_DIMENSION_SCORE / max(N_DIMENSION_BUCKETS_ACTIVE, 1)

============================================================
Formulas & Decision Policy
============================================================

Formulas:
  Pattern Multiplier (based on competitive pattern):
    if COMPETITIVE_PATTERN = "dominant_player": PATTERN_MULT = 1.25
    elif COMPETITIVE_PATTERN in {"value_champion", "quality_champion", "accessibility_champion"}: PATTERN_MULT = 1.15
    elif COMPETITIVE_PATTERN = "niche_player": PATTERN_MULT = 1.0
    elif COMPETITIVE_PATTERN = "losing_ground": PATTERN_MULT = 0.75
    else: PATTERN_MULT = 1.0

  ADJUSTED_SCORE = MEAN_DIMENSION_SCORE * PATTERN_MULT
  RAW_SCORE = BASE_SCORE + ADJUSTED_SCORE
  FINAL_SCORE = clamp(RAW_SCORE, 0.0, 10.0)

Decision Thresholds on FINAL_SCORE:
  - >= 7.5 => Category Leader
  - >= 5.5 AND < 7.5 => Strong Competitor
  - >= 3.5 AND < 5.5 => Average Competitor
  - < 3.5 => Weak Competitor

Overrides:
  - If N_BEST_IN_CATEGORY >= 2 => min Strong Competitor
  - If COMPETITIVE_PATTERN = "dominant_player" => min Strong Competitor
  - If COMPETITIVE_PATTERN = "losing_ground" AND N_BOTTOM_TIER >= 1 => max Average Competitor
  - Include positioning note based on COMPETITIVE_PATTERN
  - Include strength note based on STRONGEST_DIMENSION

============================================================
Output Schema
============================================================

{
  L0_primitives: [ ... one record per comparison-related review ... ],
  L1_composites: [
    {
      review_id,
      competitor_score,
      ranking_score,
      price_score,
      quality_score,
      convenience_score,
      recommendation_score,
      l1_comparison_score
    },
    ...
  ],
  L1_5_dimension_buckets: {
    value: { n_reviews, sum_score, mean_score, n_wins, n_losses },
    quality: { n_reviews, sum_score, mean_score, n_wins, n_losses },
    convenience: { n_reviews, sum_score, mean_score, n_wins, n_losses },
    strongest_dimension,
    strongest_score,
    weakest_dimension,
    weakest_score,
    n_dimensions_dominant,
    competitive_pattern
  },
  L2_aggregates: {
    N_COMPARISON_REVIEWS,
    CONFIDENCE_LEVEL,
    N_BEST_IN_CATEGORY, N_BOTTOM_TIER,
    TOTAL_DIMENSION_SCORE,
    MEAN_DIMENSION_SCORE,
    PATTERN_MULT,
    BASE_SCORE,
    ADJUSTED_SCORE,
    RAW_SCORE,
    FINAL_SCORE
  },
  DecisionPolicy: {
    base_verdict_by_score,
    override_applied,
    VERDICT,
    positioning_note (if applicable),
    strength_note (if applicable)
  },
  decision_evidence: {
    high_score_reviews: [ {review_id, dimension, l1_comparison_score, quote}, ... ],
    low_score_reviews: [ {review_id, dimension, l1_comparison_score, quote}, ... ],
    dimension_evidence: {
      strongest_dimension,
      weakest_dimension,
      competitive_pattern
    }
  }
}
