{
  "task_name": "allergy_safety_risk_assessment_policy",
  "filter": {
    "keywords": [
      "allergy",
      "allergic",
      "allergies",
      "nut",
      "nuts",
      "nut-free",
      "no nuts",
      "peanut",
      "peanuts",
      "peanut allergy",
      "shellfish",
      "shrimp",
      "gluten",
      "gluten-free",
      "cross-contact",
      "cross-contamination",
      "cross contamination",
      "anaphylaxis",
      "epipen",
      "epinephrine",
      "reaction",
      "rash",
      "hives",
      "swelling",
      "shortness of breath",
      "assure",
      "assurance",
      "guarantee",
      "nut-free",
      "no peanuts",
      "peanuts free",
      "accommodate",
      "allergen",
      "avoid",
      "nut allergy",
      "peanut allergy",
      "Thai",
      "Vietnamese",
      "Chinese",
      "cross contamination"
    ]
  },
  "extract": {
    "fields": [
      {
        "name": "INCIDENT_SEVERITY",
        "type": "enum",
        "values": {
          "none": "No incident mentioned",
          "Mild": "Mild incident (discomfort, minor symptoms)",
          "Moderate": "Moderate incident (visible symptoms or medicated, not life-threatening)",
          "Severe": "Severe incident (life-threatening, anaphylaxis, EpiPen, hospitalisation)"
        }
      },
      {
        "name": "ACCOUNT_TYPE",
        "type": "enum",
        "values": {
          "none": "Account type not determined",
          "Firsthand": "Reviewer experienced the incident firsthand",
          "Secondhand": "Reviewer reports someone else's experience",
          "Hypothetical": "Concern or preference without an actual incident"
        }
      },
      {
        "name": "ASSURANCE_OF_SAFETY",
        "type": "enum",
        "values": {
          "none": "No explicit assurance",
          "Assurance_given": "Explicit assurance that the item is safe for the allergy",
          "No_assurance": "Allergy discussed but no explicit assurance"
        }
      },
      {
        "name": "STAFF_RESPONSE",
        "type": "enum",
        "values": {
          "none": "No staff interaction described",
          "Accommodated": "Staff accommodated the allergy safety request",
          "Refused": "Staff refused to accommodate",
          "Dismissive": "Staff dismissed or minimized the concern",
          "Not_described": "Staff interaction not described"
        }
      },
      {
        "name": "CUISINE_RISK",
        "type": "enum",
        "values": {
          "none": "Not one of the high-risk cuisines",
          "Thai": "Thai cuisine",
          "Vietnamese": "Vietnamese cuisine",
          "Chinese": "Chinese cuisine"
        }
      },
      {
        "name": "ALLERGEN_MENTION",
        "type": "bool",
        "values": {
          "true": "Allergen or ingredient mentioned",
          "false": "No allergen mention"
        }
      },
      {
        "name": "FIRSTHAND_INCIDENT_PRESENT",
        "type": "bool",
        "values": {
          "true": "Represents a firsthand incident",
          "false": "No firsthand incident described"
        }
      }
    ]
  },
  "compute": [
    {
      "name": "N_INCIDENTS",
      "op": "count",
      "where": {
        "field": "FIRSTHAND_INCIDENT_PRESENT",
        "value": true
      }
    },
    {
      "name": "INCIDENT_POINTS",
      "op": "case",
      "source": "INCIDENT_SEVERITY",
      "rules": [
        {
          "when": "Mild",
          "then": 2
        },
        {
          "when": "Moderate",
          "then": 5
        },
        {
          "when": "Severe",
          "then": 15
        },
        {
          "when": "none",
          "then": 0
        }
      ]
    },
    {
      "name": "ASSURANCE_POINTS",
      "op": "case",
      "source": "ASSURANCE_OF_SAFETY",
      "rules": [
        {
          "when": "Assurance_given",
          "then": 5
        },
        {
          "when": "none",
          "then": 0
        },
        {
          "when": "No_assurance",
          "then": 0
        }
      ]
    },
    {
      "name": "STAFF_POINTS",
      "op": "case",
      "source": "STAFF_RESPONSE",
      "rules": [
        {
          "when": "Dismissive",
          "then": 3
        },
        {
          "when": "Accommodated",
          "then": 0
        },
        {
          "when": "Refused",
          "then": 0
        },
        {
          "when": "Not_described",
          "then": 0
        },
        {
          "when": "none",
          "then": 0
        }
      ]
    },
    {
      "name": "CUISINE_POINTS",
      "op": "case",
      "source": "CUISINE_RISK",
      "rules": [
        {
          "when": "Thai",
          "then": 2
        },
        {
          "when": "Vietnamese",
          "then": 2
        },
        {
          "when": "Chinese",
          "then": 2
        },
        {
          "when": "none",
          "then": 0
        }
      ]
    },
    {
      "name": "SCORE",
      "op": "expr",
      "expr": "INCIDENT_POINTS + ASSURANCE_POINTS + STAFF_POINTS + CUISINE_POINTS"
    },
    {
      "name": "VERDICT",
      "op": "case",
      "source": "SCORE",
      "rules": [
        {
          "when": "< 4",
          "then": "Low Risk"
        },
        {
          "when": "< 8",
          "then": "High Risk"
        },
        {
          "else": "Critical Risk"
        }
      ]
    }
  ],
  "output": [
    "VERDICT",
    "SCORE",
    "N_INCIDENTS"
  ],
  "_metadata": {
    "agenda_hash": "e6f4009275516f82",
    "policy_id": "G1_allergy_V2",
    "generated_by": "gpt-5-nano"
  }
}