## Verdict Rules
{% for rule in rules %}
{% if rule.default %}

**{{ rule.verdict }}** otherwise{% if rule.especially_when %}, especially when:
{% for condition in rule.especially_when %}
{% if condition is mapping %}
- {{ condition.text }}
{% else %}
- {{ condition }}
{% endif %}
{% endfor %}
{% endif %}
{% else %}
{% if loop.first %}

A restaurant is considered **{{ rule.verdict }}** if any of the following is true:
{% else %}

**{{ rule.verdict }}**{% if rule.precondition %} if {{ rule.precondition }}, but {% else %} if {% endif %}any of the following is true:
{% endif %}
{% for condition in rule.conditions %}
{% if condition is mapping %}
{# Use K-aware threshold: get_effective_min_count checks min_count_by_k first #}
{% set effective_count = get_effective_min_count(condition) %}
{% if effective_count < 999 %}
{# Include filter info so Phase 1 LLM can extract correct fields #}
{% if condition.filter %}
- {{ condition.text | make_threshold_explicit(effective_count) }} [filter: {% for field, values in condition.filter.items() %}{{ field }}={{ values }}{% if not loop.last %}, {% endif %}{% endfor %}]
{% else %}
- {{ condition.text | make_threshold_explicit(effective_count) }}
{% endif %}
{% endif %}
{% else %}
- {{ condition }}
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}
